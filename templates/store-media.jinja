<form id="media-form" enctype="multipart/form-data">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 600px; margin: auto;">
        <label for="title">Titre :</label>
        <input type="text" id="title" name="title">

        <label for="disc_number">Numéro du disque :</label>
        <input type="number" id="disc_number" name="disc_number">

        <label for="video_filename">Fichier Vidéo :</label>
        <input type="file" id="video_filename" name="video_filename" accept="video/*">

        <label for="media_type">Type de Média :</label>
        <select id="media_type" name="media_type" onchange="toggleSeriesFields()">
            <option value="series" selected>Série</option>
            <option value="movie">Film</option>
        </select>

        <!-- Conteneur des champs spécifiques aux séries -->
        <div id="series-fields" style="display: contents;">
            <label for="season">Saison :</label>
            <input type="number" id="season" name="season">

            <label for="episode_number">Numéro de l’épisode :</label>
            <input type="number" id="episode_number" name="episode_number">

            <label for="episode_title">Titre de L'épisode :</label>
            <input type="text" id="episode_title" name="episode_title">
        </div>
    </div>

    <div style="text-align: center; margin-top: 20px;">
        <button type="button" onclick="saveToDatabase()">Enregistrer dans la base de données</button>
    </div>
</form>

<script>
    function toggleSeriesFields() {
        const mediaType = document.getElementById("media_type").value;
        const seriesFields = document.getElementById("series-fields").children;

        for (let field of seriesFields) {
            field.style.display = (mediaType === "series") ? "block" : "none";
        }
    }

    function saveToDatabase() {
        let formData = new FormData();
        formData.append("title", document.getElementById("title").value);
        formData.append("media_type", document.getElementById("media_type").value);
        formData.append("season", document.getElementById("season").value);
        formData.append("disc_number", document.getElementById("disc_number").value);
        formData.append("episode_number", document.getElementById("episode_number").value);
        formData.append("episode_title", document.getElementById("episode_title").value);
        formData.append("video_filename", document.getElementById("video_filename").files[0]?.name || ""); 

        fetch("http://127.0.0.1:8001/save-media", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(Object.fromEntries(formData))
        })
        .then(response => response.json())
        .then(data => console.log("Résultat :", data))
        .catch(error => console.error("Erreur :", error));
    }

 </script>
